"0","# Create variable year1952"
"0","library(gapminder)"
"0",""
"0","gapminder2 <- gapminder %>%"
"0","  mutate(year1952 = year-1952)"
"0",""
"0","# Group by country, nest, use mutate to fit a model for each country"
"0","by_country <- gapminder2 %>%"
"0","  select(country, year1952, lifeExp, continent) %>%"
"0","  group_by(country, continent) %>%"
"0","  nest() %>%"
"0","  mutate(model = map(data, ~lm(lifeExp~year1952,data = .)))%>%"
"0","  ungroup()"
"0",""
"0","# Unnest the model column to return the fitted values, residuals, etc."
"0","country_model <- by_country %>%"
"0","  mutate(model = map(model, broom::augment)) %>%"
"0","  unnest(model)"
"0",""
"0","# Line plot of life expectancy for each country"
"0","p1 <- gapminder %>%"
"0","  ggplot(aes(year, lifeExp, group = country))+"
"0","  geom_line(alpha = 1/3)+"
"0","  labs(title = ""Data"", x=""Year"", y = ""Life Expectancy"")"
"0",""
"0","# Plot of fitted linear model for each country"
"0",""
"0","p2 <- ggplot(country_model) +"
"0","  geom_line(aes(x=year1952+1952, y=.fitted, group=country),alpha=1/3)+"
"0","  labs(title = ""Fitted Models"", x = ""Year"", y=""Prediction"")"
"0",""
"0","# arrange above plots into 2-column grid"
"0","gridExtra::grid.arrange(p1, p2, ncol=2)"
"0",""

"0","# Group by state then nest"
"0","# Using mutate to fit a model for each state in natural_by_state"
"0","natural_by_state <-  total_pop %>% "
"0","  mutate(month = month(Quarter)) %>%"
"0","  filter(month == ""9"") %>%"
"0","  mutate(year1981 = year(Quarter)-1981) %>%"
"0","  select(state,year1981,natural_increase) %>%"
"0","  group_by(state) %>%"
"0","  nest() %>%"
"0","  mutate(model = map(data, ~lm(natural_increase~year1981, data = .)))"
"0",""
"0","# Unnest the model column but do so in a tidy way that returns the intercept and slope coefficient"
"0","# Wrangle the data - intercept and slope coefficient as columns"
"0","natural_coefs <- natural_by_state %>%"
"0","  mutate(model = map(model, broom::tidy)) %>%"
"0","  unnest(model) %>%"
"0","  select(state, term, estimate) %>%"
"0","  spread(term, estimate) %>%"
"0","  rename(intercept = `(Intercept)`)"
"0",""
"0","# Unnest the model column to return the fitted values, residuals, etc."
"0","natural_model <- natural_by_state %>%"
"0","  mutate(model = map(model, broom::augment)) %>%"
"0","  unnest(model)"
"0",""

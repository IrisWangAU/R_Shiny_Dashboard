"0",""
"0","splt_NSW_interstate <- as_tibble(interstate_NSW_rp$splits)"
"0","splt_NSW_interstate <- splt_NSW_interstate %>%"
"0","  mutate(order = 1:nrow(splt_NSW_interstate)) %>%"
"0","  select(index, order)"
"0",""
"0",""
"0","# Create split "
"0","int_buckets_NSW <- interstate_NSW %>% "
"0","  mutate(bucket = cut(year1981, breaks=c(min(year1981)-0.1, splt_NSW_interstate$index, max(year1981)))) "
"0",""
"0","# Prediction between lower and upper bound of split (reg tree pred: mean of y)"
"0","interstate_NSW_pred <- int_buckets_NSW %>% "
"0","  group_by(bucket) %>% "
"0","  mutate(pred = mean(net_interstate)) %>% "
"0","  arrange(year1981) %>% "
"0","  separate(bucket, into = c(""lower"", ""upper""), sep = "","") %>% "
"0","  mutate(lower = as.numeric(str_remove_all(lower, ""[(]"")), upper = as.numeric(str_remove_all(upper, ""\\]""))) %>% "
"0","  select(pred, lower, upper) %>% "
"0","  distinct() %>% "
"0","  gather(""boundaries"", ""year1981"", 2:3)"
"0",""
"0","# Prediction from regression tree"
"0","ggplot(interstate_NSW) + "
"0","  geom_point(aes(x=year1981, y=net_interstate)) + "
"0","  geom_line(data=interstate_NSW_pred, aes(x=year1981, y=pred, group=pred), colour=""hotpink"", size=1.5) + "
"0","  geom_vline(data=splt_NSW_interstate, aes(xintercept = index, colour=factor(order)), linetype=2) + "
"0","  labs(title = ""Net interstate immigration predictions in pink for NSW"","
"0","       x = 'years from 2021', y = ""net interstate immigration"") + "
"0","  scale_colour_viridis_d() + theme_bw() + "
"0","  theme(legend.position=""none"")"
